<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Monitoramento Petshop</title>

    <!-- Fonte mais bonita -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root{
            --bg-start: #6ea8ff;
            --bg-end: #dbe9ff;
            --card: #ffffff;
            --accent: #3b82f6;
            --muted: #6b7280;
            --success:#16a34a;
            --danger:#ef4444;
            --glass: rgba(255,255,255,0.6);
        }

        *{box-sizing:border-box}
        html,body{height:100%}
        body {
            margin:0;
            font-family: "Poppins", Arial, sans-serif;
            background: linear-gradient(135deg,var(--bg-start),var(--bg-end));
            background-attachment: fixed;
            color:#111827;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        .wrap {
            max-width:1100px;
            margin:30px auto;
            padding:28px;
        }

        .titulo-pet {
            text-align: center;
            font-size: 40px;
            font-weight: 800;
            color: #0f172a;
            margin: 6px 0 18px;
            text-shadow: 0 6px 18px rgba(15,23,42,0.08);
            letter-spacing: -0.5px;
        }

        .titulo-pet small{
            display:block;
            font-weight:300;
            font-size:14px;
            color:var(--muted);
            margin-top:6px;
        }

        .dashboard {
            display:grid;
            grid-template-columns: 1fr 480px;
            gap:28px;
            align-items:start;
        }

        /* painel principal */
        .panel{
            background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
            border-radius:14px;
            padding:20px;
            box-shadow: 0 10px 30px rgba(2,6,23,0.08);
            backdrop-filter: blur(6px);
        }

        .sensors {
            display:flex;
            gap:14px;
            flex-wrap:wrap;
        }

        .card {
            background: var(--card);
            border-radius:12px;
            padding:16px;
            min-width:170px;
            flex:1;
            box-shadow: 0 6px 18px rgba(11,22,70,0.06);
            transition: transform .2s ease, box-shadow .2s ease;
        }

        .card:hover{
            transform: translateY(-6px);
            box-shadow: 0 18px 40px rgba(11,22,70,0.09);
        }

        .card h3{
            margin:0;
            font-size:14px;
            color:var(--muted);
            display:flex;
            align-items:center;
            gap:8px;
            font-weight:600;
        }

        .value {
            margin-top:10px;
            font-size:28px;
            font-weight:800;
            color:#0f172a;
        }

        .small {
            font-size:12px;
            color:var(--muted);
            margin-top:6px;
        }

        /* camera */
        #camera {
            height:330px;
            border-radius:12px;
            overflow:hidden;
            position:relative;
            background:linear-gradient(180deg, #11182708, #ffffff30);
            display:flex;
            align-items:center;
            justify-content:center;
            background-image: url("{{ url_for('imagens', filename='camera.png') }}");
            background-size: cover;
            background-position:center;
            box-shadow: 0 14px 40px rgba(2,6,23,0.08);
        }

        #camera .overlay {
            position:absolute;
            inset:0;
            background:linear-gradient(180deg, transparent, rgba(0,0,0,0.12));
        }

        #camera .controls {
            position:absolute;
            top:12px;
            right:12px;
            display:flex;
            gap:8px;
        }

        .btn {
            background:rgba(255,255,255,0.12);
            border:1px solid rgba(255,255,255,0.14);
            color:white;
            padding:8px 12px;
            border-radius:8px;
            cursor:pointer;
            backdrop-filter: blur(4px);
            font-weight:600;
            box-shadow: 0 6px 18px rgba(2,6,23,0.06);
        }

        #expandir {
            background: rgba(0,0,0,0.6);
            color:#fff;
            border:none;
            padding:8px 12px;
            border-radius:8px;
            cursor:pointer;
            font-weight:700;
        }

        /* hist√≥rico */
        #historico {
            margin-top:22px;
            border-radius:12px;
            padding:16px;
            background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.92));
            box-shadow: 0 12px 30px rgba(2,6,23,0.06);
        }

        #historico h2{
            margin:0 0 12px 0;
            font-size:18px;
            color:#0f172a;
        }

        #lista{
            max-height:220px;
            overflow:auto;
            padding-right:8px;
        }

        #lista p{
            margin:8px 0;
            color:var(--muted);
            font-size:14px;
            border-left:3px solid rgba(59,130,246,0.12);
            padding-left:10px;
        }

        .status-dot{
            display:inline-block;
            width:10px;
            height:10px;
            border-radius:50%;
            margin-right:8px;
        }

        .presenca-on{background:var(--success)}
        .presenca-off{background:var(--danger)}

        /* responsivo */
        @media (max-width:980px){
            .dashboard{grid-template-columns:1fr; padding-bottom:6px}
            #camera{height:260px}
        }

        /* anima√ß√£o quando atualiza */
        .pulse {
            animation: pulse .9s ease;
        }
        @keyframes pulse{
            0%{transform:translateY(0)}
            50%{transform:translateY(-4px)}
            100%{transform:translateY(0)}
        }
    </style>
</head>
<body>

<div class="wrap">
    <h1 class="titulo-pet">üêæ Monitoramento do Petshop <small>Atualiza√ß√µes em tempo real</small></h1>

    <div class="dashboard">
        <div class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                <div>
                    <h2 style="margin:0;font-size:20px;">Ambiente</h2>
                    <div class="small">Dados dos sensores</div>
                </div>
                <div class="small" id="lastUpdate">‚Äî</div>
            </div>

            <div class="sensors">
                <div class="card">
                    <h3>üå°Ô∏è Temperatura</h3>
                    <div class="value" id="temp">-- ¬∞C</div>
                    <div class="small">Faixa ideal: 20‚Äì26¬∞C</div>
                </div>

                <div class="card">
                    <h3>üíß Umidade</h3>
                    <div class="value" id="umid">-- %</div>
                    <div class="small">Faixa ideal: 40‚Äì60%</div>
                </div>

                <div class="card" id="card-pres">
                    <h3>üëÄ Presen√ßa</h3>
                    <div class="value" id="pres">--</div>
                    <div class="small" id="pres-desc">Nenhum movimento detectado</div>
                </div>
            </div>

            <div id="historico" style="margin-top:18px">
                <h2>üìú Hist√≥rico do Dia</h2>
                <div id="lista"></div>
            </div>
        </div>

        <div id="camera" class="panel" role="region" aria-label="Camera">
            <div class="overlay"></div>
            <div class="controls">
                <button class="btn" id="snapshot" title="Tirar foto">üì∏</button>
                <button id="expandir" title="Expandir tela">‚õ∂</button>
            </div>
        </div>
    </div>
</div>

<script>
/* Busca e atualiza os sensores ‚Äî mant√©m funcionalidade original com anima√ß√£o */
function safe(v){ return v === undefined || v === null ? '‚Äî' : v; }

async function atualizar() {
    try {
        let resposta = await fetch("/dados");
        if(!resposta.ok) throw new Error("HTTP " + resposta.status);
        let dados = await resposta.json();

        const t = safe(dados.temperatura);
        const u = safe(dados.umidade);
        const p = safe(dados.presenca);

        document.getElementById("temp").innerText = (t !== '‚Äî') ? Number(t).toFixed(1) + " ¬∞C" : "‚Äî";
        document.getElementById("umid").innerText = (u !== '‚Äî') ? Number(u).toFixed(0) + " %" : "‚Äî";
        document.getElementById("pres").innerText = p;
        document.getElementById("pres-desc").innerText = (p && p.toString().toLowerCase().includes('sim')) ? "Movimento detectado" : "Nenhum movimento detectado";

        // indicador visual de presen√ßa
        const presDot = document.querySelector('#card-pres .status-dot') || null;
        if(!presDot){
            const dot = document.createElement('span');
            dot.className = 'status-dot ' + ((p && p.toString().toLowerCase().includes('sim')) ? 'presenca-on' : 'presenca-off');
            document.getElementById('card-pres').querySelector('h3').prepend(dot);
        } else {
            presDot.className = 'status-dot ' + ((p && p.toString().toLowerCase().includes('sim')) ? 'presenca-on' : 'presenca-off');
        }

        // hist√≥rico
        let lista = "";
        if (Array.isArray(dados.historico)) {
            dados.historico.forEach(item => {
                lista += `<p><strong>${item.hora}</strong> ‚Äî Temp: ${item.temperatura}¬∞C, Umid: ${item.umidade}%, Presen√ßa: ${item.presenca}</p>`;
            });
        } else {
            lista = "<p class='small'>Nenhum hist√≥rico dispon√≠vel.</p>"
        }
        const listaEl = document.getElementById("lista");
        listaEl.innerHTML = lista;

        // efeito pulse nas cards atualizadas
        document.querySelectorAll('.value').forEach(el => {
            el.classList.remove('pulse');
            void el.offsetWidth;
            el.classList.add('pulse');
        });

        // last update
        const now = new Date();
        document.getElementById("lastUpdate").innerText = "√öltima: " + now.toLocaleTimeString();

    } catch(e) {
        console.log("Erro ao buscar dados:", e);
        document.getElementById("lastUpdate").innerText = "Erro de conex√£o";
    }
}

setInterval(atualizar, 3000);
atualizar();

// Bot√£o de expandir tela
document.getElementById("expandir").onclick = () => {
    let cam = document.getElementById("camera");
    if (!document.fullscreenElement) {
        cam.requestFullscreen().catch(()=>{});
    } else {
        document.exitFullscreen().catch(()=>{});
    }
};

// snapshot fake (pode ligar ao endpoint de snapshot)
document.getElementById("snapshot").onclick = () => {
    alert("Snapshot solicitado (implemente endpoint /snapshot para salvar imagem).");
};
</script>

</body>
</html>